---
const { photos, id } = Astro.props;
---

<div class={`photo-carousel-wrapper ${id}-wrapper`} id={`${id}-wrapper`}>
  <div class="swiper" id={`${id}-swiper`}>
    <div class="swiper-wrapper">
      {photos.map((photo, index) => (
        <div class="swiper-slide">
          <div class="photo-card">
            <img
              src={photo.src}
              alt={photo.alt}
              loading="lazy"
              class="photo-image"
            />
          </div>
        </div>
      ))}
    </div>

    <div class={`swiper-button-prev ${id}-prev`}>
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </div>
    <div class={`swiper-button-next ${id}-next`}>
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </div>

    <div class={`swiper-pagination ${id}-pagination`}></div>
  </div>
</div>

<style>
  .photo-carousel-wrapper {
    position: relative;
    width: 100%;
    padding: 1rem 0 3rem;
  }

  .swiper {
    overflow: visible !important;
    width: 100%;
    padding: 0 4rem;
  }

  @media (max-width: 768px) {
    .swiper {
      padding: 0 3rem;
    }
  }

  .swiper-slide {
    opacity: 0.4;
    transition: opacity 0.3s ease, transform 0.3s ease;
    transform: scale(0.85);
  }

  .swiper-slide-active {
    opacity: 1;
    transform: scale(1);
  }

  .photo-card {
    position: relative;
    overflow: hidden;
    border-radius: 1.5rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    aspect-ratio: 16 / 9;
    background: #f0f0f0;
  }

  .photo-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .swiper-button-prev,
  .swiper-button-next {
    width: 3rem;
    height: 3rem;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.2s ease;
    z-index: 10;
  }

  .swiper-button-prev:hover,
  .swiper-button-next:hover {
    background: #ffffff;
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
    transform: translateY(-50%) scale(1.05);
  }

  .swiper-button-prev::after,
  .swiper-button-next::after {
    display: none;
  }

  .swiper-button-prev svg,
  .swiper-button-next svg {
    width: 1.25rem;
    height: 1.25rem;
    color: #0d9488;
  }

  .swiper-button-prev {
    left: 0.5rem;
  }

  .swiper-button-next {
    right: 0.5rem;
  }

  .swiper-pagination {
    bottom: 0 !important;
  }

  .swiper-pagination-bullet {
    width: 0.625rem;
    height: 0.625rem;
    background: rgba(13, 148, 136, 0.3);
    opacity: 1;
    transition: all 0.2s ease;
  }

  .swiper-pagination-bullet-active {
    width: 1.5rem;
    border-radius: 0.25rem;
    background: #0d9488;
  }
</style>

<script define:vars={{ photos, id }}>
  // Load Swiper from CDN
  import('https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.mjs')
    .then(module => {
      const Swiper = module.default;

      const slidesCount = photos.length;
      let slidesPerView = 2.5;
      if (slidesCount <= 3) {
        slidesPerView = 1.5;
      } else if (slidesCount >= 5) {
        slidesPerView = 3;
      }

      new Swiper(`#${id}-swiper`, {
        modules: [module.Navigation, module.Pagination, module.EffectCoverflow, module.Autoplay],
        slidesPerView: slidesPerView,
        spaceBetween: 20,
        centeredSlides: true,
        loop: true,
        speed: 500,
        effect: 'coverflow',
        coverflowEffect: {
          rotate: 0,
          stretch: 0,
          depth: 100,
          modifier: 1,
          slideShadows: false,
        },
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
          pauseOnMouseEnter: true,
        },
        navigation: {
          nextEl: `.${id}-next`,
          prevEl: `.${id}-prev`,
        },
        pagination: {
          el: `.${id}-pagination`,
          clickable: true,
          dynamicBullets: true,
        },
        breakpoints: {
          320: {
            slidesPerView: 1,
            spaceBetween: 10,
            centeredSlides: false,
            effect: 'slide',
          },
          640: {
            slidesPerView: 1.2,
            spaceBetween: 15,
            centeredSlides: false,
            effect: 'slide',
          },
          768: {
            slidesPerView: 1.8,
            spaceBetween: 20,
            centeredSlides: true,
            effect: 'coverflow',
          },
          1024: {
            slidesPerView: slidesPerView,
            spaceBetween: 20,
            centeredSlides: true,
            effect: 'coverflow',
          },
        },
        on: {
          init: function() {
            setTimeout(() => {
              this.update();
            }, 100);
          },
        },
      });
    })
    .catch(err => console.error('Failed to load Swiper:', err));
</script>
