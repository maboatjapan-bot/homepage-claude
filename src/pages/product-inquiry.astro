---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import FadeIn from '../components/FadeIn.astro';
import ScaleIn from '../components/ScaleIn.astro';
import HeroGradient from '../components/HeroGradient.astro';
---

<BaseLayout>
  <Header />

  <!-- SEO -->
  <SEO
    title="製品のお問い合わせ"
    description="ポポフ、ピッとパッ!、ピッとシュ! などの製品に関するお問い合わせ。購入証明書の添付や製品不具合のご報告も承ります。電話：0120-284-612"
    path="/product-inquiry"
  />

  <!-- Breadcrumb -->
  <Breadcrumb
    items={[
      { name: 'ホーム', url: '/' },
      { name: '製品お問い合わせ', url: '/product-inquiry' }
    ]}
  />

  <!-- Hero -->
  <section class="pt-32 pb-24 px-6 bg-gradient-to-b from-slate-50 to-white relative overflow-hidden">
    <HeroGradient />
    <div class="max-w-4xl mx-auto text-center relative z-10">
      <FadeIn>
        <h1 class="text-5xl sm:text-6xl md:text-7xl font-bold tracking-tight text-slate-900 mb-6">
          製品・サービスに関するお問い合わせ
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto">
          お問い合わせ内容に応じて、<br class="hidden sm:block" />
          担当のメールアドレスに送信いたします。
        </p>
      </FadeIn>
    </div>
  </section>

  <!-- Contact Form -->
  <section class="pt-20 py-16 px-6 bg-slate-50">
    <div class="max-w-3xl mx-auto">
      <ScaleIn delay={0} from={0.95}>
        <div class="bg-white rounded-3xl p-8 md:p-12 shadow-xl shadow-slate-200/50">
          <style>
            .v-contact__response {
              padding: 1rem 1.5rem;
              border-radius: 1rem;
              margin-top: 1rem;
            }
            .v-contact__response.is-error {
              background-color: #fef2f2;
              border: 1px solid #fecaca;
              color: #991b1b;
            }
            .v-contact__response.is-success {
              background-color: #f0fdf4;
              border: 1px solid #bbf7d0;
              color: #166534;
            }
            .checkbox-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 0.75rem;
            }
            @media (min-width: 640px) {
              .checkbox-grid {
                grid-template-columns: repeat(2, 1fr);
              }
            }
          </style>
          <form
            id="productInquiryForm"
            class="space-y-6"
          >
            <!-- Silent bot protection -->
            <input type="text" name="website" id="hp" class="hidden" tabindex="-1" autocomplete="off">
            <input type="hidden" id="timestamp" name="timestamp" value="">

            <!-- Checkboxes -->
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-4">
                お問い合わせ内容 <span class="text-red-500">*</span>
                <span class="text-xs text-slate-500 font-normal">（該当するものを1つ以上選択してください）</span>
              </label>
              <div class="checkbox-grid mt-3">
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="ポポフ」ポータブル電源" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">「ポポフ」ポータブル電源</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="ピッとパッ!」アルコール検知器" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">「ピッとパッ!」アルコール検知器</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="ピッとシュ!」検温消毒器" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">「ピッとシュ!」検温消毒器</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="システム開発" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">システム開発</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="AWS" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">AWS</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="Virtuozzo" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">Virtuozzo</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="With-AI" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">With AI</span>
                </label>
                <label class="flex items-start gap-3 p-3 rounded-xl border border-slate-300 hover:border-brand-teal hover:bg-brand-teal/5 cursor-pointer transition-all">
                  <input type="checkbox" name="products" value="その他" class="mt-1 w-5 h-5 text-brand-teal rounded border-slate-300 focus:ring-2 focus:ring-brand-teal/20">
                  <span class="text-sm text-slate-700">その他</span>
                </label>
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mt-6">
              <!-- Name -->
              <div>
                <label for="name" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ 氏名 <span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                  placeholder="例) 山田 太郎"
                />
              </div>

              <!-- Email -->
              <div>
                <label for="email" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ メールアドレス <span class="text-red-500">*</span>
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                  placeholder="例) example@gmail.com"
                />
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- Phone -->
              <div>
                <label for="phone" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ 電話番号
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                  placeholder="例) 03-1234-5678"
                />
              </div>

              <!-- Lot Number -->
              <div>
                <label for="lot" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ 管理番号(ロットNo.)
                </label>
                <input
                  type="text"
                  id="lot"
                  name="lot"
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                  placeholder="例) SPSCWW2WSE"
                />
              </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- Purchase Date -->
              <div>
                <label for="purchaseDate" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ 購入日 <span class="text-red-500">*</span>
                </label>
                <input
                  type="date"
                  id="purchaseDate"
                  name="purchaseDate"
                  required
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                />
              </div>

              <!-- Quantity -->
              <div>
                <label for="quantity" class="block text-sm font-medium text-slate-700 mb-2">
                  ■ 購入数
                </label>
                <input
                  type="number"
                  id="quantity"
                  name="quantity"
                  min="1"
                  class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none transition-all"
                  placeholder="例) 5"
                />
              </div>
            </div>

            <!-- File Upload -->
            <div>
              <label class="block text-sm font-medium text-slate-700 mb-2">
                ■ 購入証明（領収書・納品書など）の添付
              </label>
              <div
                id="dropzone"
                class="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center hover:border-brand-teal hover:bg-brand-teal/5 transition-all cursor-pointer"
                role="button"
                tabindex="0"
                aria-label="ファイルをアップロード"
              >
                <svg class="w-12 h-12 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                </svg>
                <p class="text-slate-600 mb-2">クリックまたはドラッグ＆ドロップでファイルをアップロード</p>
                <p class="text-sm text-slate-500">最大3ファイル、1ファイル最大8MB（JPG, JPEG, PNG, PDF）</p>
              </div>
              <input type="file" id="attachments" name="attachments" multiple accept=".jpg,.jpeg,.png,.pdf" class="hidden">
              <ul id="fileList" class="mt-3 space-y-2"></ul>
            </div>

            <!-- Message -->
            <div>
              <label for="content" class="block text-sm font-medium text-slate-700 mb-2">
                ■ お問い合わせの具体的な内容 <span class="text-red-500">*</span>
              </label>
              <textarea
                id="content"
                name="content"
                required
                rows="6"
                class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-brand-teal focus:ring-2 focus:ring-brand-teal/20 outline-none resize-none"
                placeholder="製品不具合の場合はその詳細をご記入下さい。"
              ></textarea>
            </div>

            <!-- Status Message -->
            <div id="status" class="v-contact__response"></div>

            <!-- Submit Button -->
            <button
              type="submit"
              id="submitBtn"
              class="w-full px-8 py-4 bg-brand-teal hover:bg-brand-teal-dark text-white text-base font-medium rounded-full transition-all shadow-xl shadow-brand-teal/25 flex items-center justify-center gap-2"
            >
              送信する
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
            </button>

            <!-- Success Message -->
            <div id="form-success" class="hidden p-6 bg-green-50 border border-green-200 rounded-2xl">
              <div class="flex items-center gap-3">
                <svg class="w-6 h-6 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div>
                  <h3 class="font-semibold text-green-900">送信完了しました</h3>
                  <p class="text-sm text-green-700 mt-1">お問い合わせありがとうございます。内容を確認次第、ご連絡いたします。</p>
                </div>
              </div>
            </div>

            <!-- Error Message -->
            <div id="form-error" class="hidden p-6 bg-red-50 border border-red-200 rounded-2xl">
              <div class="flex items-center gap-3">
                <svg class="w-6 h-6 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div>
                  <h3 class="font-semibold text-red-900">エラーが発生しました</h3>
                  <p class="text-sm text-red-700 mt-1">もう一度お試しいただくか、お電話でお問い合わせください。</p>
                </div>
              </div>
          </form>

          <script>
            const form = document.getElementById('productInquiryForm');
            const successMsg = document.getElementById('form-success');
            const errorMsg = document.getElementById('form-error');
            const submitBtn = document.getElementById('submitBtn');
            const statusEl = document.getElementById('status');

            // UMS API Configuration
            const API_URL = 'https://ums.aws.swiftechie.com/api/operation/sendByEmail';

            // Product categories - all products send to support@, no products → info@
            const MIN_SECONDS_TO_SUBMIT = 3;
            const LAST_SEND_KEY = 'swiftechie_product_inquiry_last_send';

            // File upload constants
            const MAX_FILES = 3;
            const MAX_FILE_SIZE = 8 * 1024 * 1024; // 8MB in bytes
            const ALLOWED_EXT = ['jpg', 'jpeg', 'png', 'pdf'];

            const startedAt = Date.now();

            // Set timestamp on page load (silent bot protection)
            document.getElementById('timestamp').value = Date.now().toString();

            // File upload handling
            const dropzone = document.getElementById('dropzone');
            const attachmentsInput = document.getElementById('attachments');
            const fileList = document.getElementById('fileList');

            function renderFileList() {
              fileList.innerHTML = '';
              const files = Array.from(attachmentsInput.files || []);
              if (!files.length) return;

              files.forEach((f, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between bg-slate-50 px-4 py-2 rounded-lg group';
                li.innerHTML = `
                  <div class="flex items-center gap-3 flex-1 min-w-0">
                    <svg class="w-5 h-5 text-slate-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="text-sm text-slate-700 truncate">${f.name}</span>
                    <span class="text-xs text-slate-500 flex-shrink-0">(${Math.ceil(f.size / 1024)} KB)</span>
                  </div>
                  <button
                    type="button"
                    class="delete-file-btn text-slate-400 hover:text-red-500 transition-colors p-1 rounded-md hover:bg-red-50"
                    data-index="${index}"
                    aria-label="ファイルを削除"
                    title="ファイルを削除"
                  >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                `;
                fileList.appendChild(li);
              });

              // Add delete button listeners
              fileList.querySelectorAll('.delete-file-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                  const indexToRemove = parseInt(e.currentTarget.dataset.index || '0');
                  removeFile(indexToRemove);
                });
              });
            }

            function removeFile(indexToRemove) {
              const files = Array.from(attachmentsInput.files || []);
              if (indexToRemove >= 0 && indexToRemove < files.length) {
                const dataTransfer = new DataTransfer();
                files.forEach((f, index) => {
                  if (index !== indexToRemove) {
                    dataTransfer.items.add(f);
                  }
                });
                attachmentsInput.files = dataTransfer.files;
                renderFileList();
              }
            }

            function validateFiles() {
              const files = Array.from(attachmentsInput.files || []);
              if (!files.length) return true;
              if (files.length > MAX_FILES) {
                setStatus(`最大${MAX_FILES}個のファイルまで添付できます。現在${files.length}個のファイルが選択されています。削除ボタンで${files.length - MAX_FILES}個のファイルを削除してください。`, 'is-error');
                return false;
              }
              for (const f of files) {
                const ext = (f.name.split('.').pop() || '').toLowerCase();
                if (!ALLOWED_EXT.includes(ext)) {
                  showError(`許可されていないファイル形式です：${f.name}`);
                  return false;
                }
                if (f.size > MAX_FILE_SIZE) {
                  showError(`ファイルサイズが大きすぎます：${f.name}`);
                  return false;
                }
              }
              resetStatus();
              return true;
            }

            dropzone.addEventListener('click', () => attachmentsInput.click());
            dropzone.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                attachmentsInput.click();
              }
            });

            // Drag and drop
            ['dragenter', 'dragover'].forEach((evt) => {
              dropzone.addEventListener(evt, (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropzone.classList.add('border-brand-teal', 'bg-brand-teal/10');
              });
            });

            ['dragleave', 'drop'].forEach((evt) => {
              dropzone.addEventListener(evt, (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropzone.classList.remove('border-brand-teal', 'bg-brand-teal/10');
              });
            });

            dropzone.addEventListener('drop', (e) => {
              e.preventDefault();
              e.stopPropagation();
              dropzone.classList.remove('border-brand-teal', 'bg-brand-teal/10');

              const newFiles = Array.from(e.dataTransfer.files || []);
              if (newFiles.length === 0) return;

              const currentFiles = Array.from(attachmentsInput.files || []);
              const mergedFiles = [...currentFiles, ...newFiles];

              const dataTransfer = new DataTransfer();
              mergedFiles.forEach(f => dataTransfer.items.add(f));
              attachmentsInput.files = dataTransfer.files;

              if (mergedFiles.length > MAX_FILES) {
                setStatus(`${mergedFiles.length}個のファイルが選択されています。最大${MAX_FILES}個までです。削除ボタンで${mergedFiles.length - MAX_FILES}個のファイルを削除してください。`, 'is-error');
              } else {
                resetStatus();
              }
              renderFileList();
            });

            attachmentsInput.addEventListener('change', (e) => {
              const newFiles = Array.from(attachmentsInput.files || []);
              if (newFiles.length > MAX_FILES) {
                setStatus(`${newFiles.length}個のファイルが選択されています。最大${MAX_FILES}個までです。削除ボタンで${newFiles.length - MAX_FILES}個のファイルを削除してください。`, 'is-error');
                renderFileList();
                return;
              }
              resetStatus();
              renderFileList();
            });

            // Status messages
            function setStatus(msg, type) {
              statusEl.textContent = msg || '';
              statusEl.className = 'v-contact__response' + (type ? ' ' + type : '');
            }

            function showError(msg) {
              setStatus(msg, 'is-error');
            }

            function showSuccess(msg) {
              setStatus(msg, 'is-success');
            }

            function resetStatus() {
              setStatus('', '');
            }

            // Utility functions
            function canSendNow() {
              const last = Number(localStorage.getItem(LAST_SEND_KEY) || '0');
              return Date.now() - last >= 60 * 1000;
            }

            function markSent() {
              localStorage.setItem(LAST_SEND_KEY, String(Date.now()));
            }

            function escapeHtml(s) {
              return String(s ?? '')
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#039;');
            }

            function determineEmailGroup(products) {
              // If any product option is selected, send to support@
              // Products include: ポポフ, AWS, etc. AND With AI, その他
              if (products.length > 0) {
                return 'contact-pro'; // support@swiftechie.com
              } else {
                // No product selected, send to info@
                return 'contact-others'; // info@swiftechie.com
              }
            }

            function buildHtmlContent(data, files) {
              const sentAt = new Date().toLocaleString('ja-JP', { hour12: false });
              const productLabels = Array.from(document.querySelectorAll('input[name="products"]:checked'))
                .map(cb => cb.nextElementSibling?.textContent?.trim() || cb.value)
                .filter(Boolean);
              const productNames = productLabels.length > 0 ? productLabels.join('、') : 'なし';

              const fileNames = files.length ? files.map((f) => f.name).join(' / ') : 'なし';

              return [
                '<p>',
                  '【 お問い合わせ内容 】' + escapeHtml(data.content).replaceAll('\\n', '<br />'),
                  '</p>',
                  '<hr />',
                  '<p>',
                  '【 製品カテコリー 】' + escapeHtml(productNames) + '<br />',
                  '【 氏名 】' + escapeHtml(data.name) + '<br />',
                  '【 メールアドレス 】' + escapeHtml(data.email) + '<br />',
                  '【 電話番号 】' + escapeHtml(data.phone || '未記入') + '<br />',
                  '【 管理番号 】' + escapeHtml(data.lot || '未記入') + '<br />',
                  '【 購入日 】' + escapeHtml(data.purchaseDate || '未記入') + '<br />',
                  '【 購入数 】' + escapeHtml(data.quantity || '未記入') + '<br />',
                  '【 添付ファイル 】' + escapeHtml(fileNames) + '<br />',
                  '【 送信日時 】' + escapeHtml(sentAt) + '<br />',
                  '</p>',
                  '<p>&nbsp;</p>',
              ].join('');
            }

            async function sendMail({ title, emailGroupKey, content, files }) {
              const fd = new FormData();
              fd.append('title', title);
              fd.append('emailGroupKey', emailGroupKey);
              fd.append('content', content);
              files.forEach((f) => fd.append('attachment', f));

              const res = await fetch(API_URL, {
                method: 'POST',
                headers: { accept: '*/*' },
                body: fd,
              });

              if (!res.ok) throw new Error('HTTP ' + res.status);
            }

            // Form submission
            form.addEventListener('submit', async (e) => {
              e.preventDefault();
              resetStatus();

              // Honeypot check (spam protection)
              const hp = form.querySelector('input[name="website"]')?.value || '';
              if (hp.trim() !== '') return;

              // Minimum time check
              const sec = (Date.now() - startedAt) / 1000;
              if (sec < MIN_SECONDS_TO_SUBMIT) {
                showError('少し時間をおいてから送信してください。');
                return;
              }

              // Rate limiting
              if (!canSendNow()) {
                showError('送信回数が多すぎます。しばらく待ってから再度お試しください。');
                return;
              }

              // File validation
              if (!validateFiles()) {
                return;
              }

              // Check if at least one product is selected
              const selectedProducts = Array.from(document.querySelectorAll('input[name="products"]:checked'));
              if (selectedProducts.length === 0) {
                showError('お問い合わせ内容を1つ以上選択してください。');
                return;
              }

              // Disable button and show loading
              submitBtn.disabled = true;
              submitBtn.innerHTML = `
                <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                送信中...
              `;

              try {
                // Get form data
                const formData = new FormData(form);
                const data = {
                  name: formData.get('name') || '',
                  email: formData.get('email') || '',
                  phone: formData.get('phone') || '',
                  lot: formData.get('lot') || '',
                  purchaseDate: formData.get('purchaseDate') || '',
                  quantity: formData.get('quantity') || '',
                  content: formData.get('content') || '',
                };

                // Get selected products
                const products = Array.from(document.querySelectorAll('input[name="products"]:checked'))
                  .map(cb => cb.value);

                // Determine email group based on product selection
                const emailGroupKey = determineEmailGroup(products);

                const TITLE = '【シーテック株式会社】製品のお問い合わせ';

                // Get files
                const files = Array.from(attachmentsInput.files || []);

                // Send email
                await sendMail({
                  title: TITLE,
                  emailGroupKey: emailGroupKey,
                  content: buildHtmlContent(data, files),
                  files: files,
                });

                // Mark as sent
                markSent();

                // Show success
                successMsg.classList.remove('hidden');
                form.reset();
                fileList.innerHTML = '';
                successMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
              } catch (error) {
                console.error('Form submission error:', error);
                errorMsg.classList.remove('hidden');
                errorMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
              } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                  送信する
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                  </svg>
                `;
              }
            });
          </script>
        </div>
      </ScaleIn>
    </div>
  </section>

  <!-- Contact Info -->
  <section class="pt-20 py-24 px-6 bg-white">
    <div class="max-w-7xl mx-auto">
      <FadeIn>
        <div class="text-center mb-16">
          <h2 class="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">
            お問い合わせ先
          </h2>
        </div>
      </FadeIn>

      <div class="grid md:grid-cols-2 gap-8 max-w-3xl mx-auto">
        <ScaleIn delay={0} from={0.95}>
          <div class="text-center">
            <div class="w-16 h-16 bg-brand-teal/10 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-brand-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">電話番号</h3>
            <p class="text-slate-600">0120-284-612</p>
            <p class="text-sm text-slate-500 mt-1">受付時間 AM10:00〜12:00 PM1:00〜5:00</p>
            <p class="text-xs text-slate-400">（土日祝・夏期休暇・年末年始を除く）</p>
          </div>
        </ScaleIn>

        <ScaleIn delay={100} from={0.95}>
          <a
            href="https://www.google.com/maps/search/?api=1&query=東京都中央区新川1-14-5金盃第3ビル7F"
            target="_blank"
            rel="noopener noreferrer"
            class="text-center hover:opacity-80 transition-opacity"
          >
            <div class="w-16 h-16 bg-brand-teal/10 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-brand-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 mb-2">住所</h3>
            <p class="text-slate-600">〒104-0033</p>
            <p class="text-slate-600">東京都中央区新川1-14-5<br/>金盃第3ビル7F</p>
            <p class="text-xs text-slate-400 mt-1">クリックで地図を開く</p>
          </a>
        </ScaleIn>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>
